<!DOCTYPE html>
<html>

<head>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            background-color: #f5f5f5;
        }

        a {
            color: #4183C4;
            text-decoration: none;
        }

        p {
            line-height: 20px;
        }

        .content {
            max-width: 800px;
            margin: auto;
        }

        #abs {
            text-align: center;
        }

        #abs .descriptor {
            display: none;
        }

        #abs h1.title {
            margin: .5em 0 .5em 20px;
            font-size: x-large;
            font-weight: bold;
            line-height: 120%;
        }

        #abs .authors {
            margin: .5em 0 .5em 20px;
            font-size: medium;
            line-height: 150%;
        }

        #abs .authors a {
            font-size: medium;
        }

        #abs p {
            text-align: justify;
        }

        .bib {
            font-size: small;
        }

        .figure {
            text-align: center;
        }
    </style>
</head>
<body>
<div class="content">
    <div id="abs">
        <h1>Learning Latent Space Energy-Based Prior Model</h1>
        <div class="authors"><a href="mailto:bopang@ucla.edu">Bo Pang</a><sup>*</sup>, <a href="mailto:than6@stevens.edu">Tian Han</a><sup>*</sup>, <a href="mailto:enijkamp@ucla.edu">Erik Nijkamp</a><sup>*</sup>, <a href="mailto:sczhu@stat.ucla.edu">Song-Chun Zhu</a>, <a href="mailto:ywu@stat.ucla.edu">Ying Nian Wu</a></div>
        <div class="inst">
            <sup>*</sup> Equal contributions<br>
            University of California, Los Angeles (UCLA), USA<br>
        </div>
        <h2>Abstract</h2>
        <p>The generator model assumes that the observed example is generated by a low- dimensional latent vector via a top-down network, and the latent vector follows a simple and known prior distribution, such as uniform or Gaussian white noise distribution. While we can learn an expressive top-down network to map the prior distribution to the data distribution, we can also learn an expressive prior model instead of assuming a given prior distribution. This follows the philosophy of empirical Bayes where the prior model is learned from the observed data. We propose to learn an energy-based prior model for the latent vector, where the energy function is parametrized by a very simple multi-layer perceptron. Due to the low- dimensionality of the latent space, learning a latent space energy-based prior model proves to be both feasible and desirable. In this paper, we develop the maximum likelihood learning algorithm and its variation based on short-run Markov chain Monte Carlo sampling from the prior and the posterior distributions of the latent vector, and we show that the learned model exhibits strong performance in terms of image and text generation and anomaly detection.</p>
    </div>
    <hr>
    <h2>Paper</h2>
    The publication can be obtained <a href="https://arxiv.org/abs/2006.08205">here</a>.
    <pre class="bib">
@article{pang2020ebmprior,
  title={Learning Latent Space Energy-Based Prior Model},
  author={Pang, Bo and Han, Tian and Nijkamp, Erik and Zhu, Song-Chun and Wu, Ying Nian},
  journal={NeurIPS},
  year={2020}
}
</pre>
    <hr>

    <h2>Contributions</h2>
    <p>(1) We propose a generator model with a latent space energy-based prior model by following the empirical Bayes philosophy.<br>
(2) We develop the maximum likelihood learning algorithm based on MCMC sampling of the latent vector from the prior and posterior distributions.<br>
(3) We further develop an efficient modification of MLE learning based on short-run MCMC sampling.<br>
(4) We provide theoretical foundation for learning driven by short-run MCMC.<br>
(5) We provide strong empirical results to corroborate the proposed method.</p>
    <hr>
    

    <h2>Code</h2>
    <p>The code can be obtained <a href="https://github.com/bpucla/latent-space-EBM-prior">here</a>. </p>
    <hr>
    
    <h2>Experiments</h2>
    <h3>Experiment 1: Image</h3>
    <p>The generator network \(p_\theta\) in our framework is well-learned to generate samples that are realistic and share visual similarities as the training data. The qualitative results are shown in Figure 1. We further evaluate our model quantitatively by using Fr√©chet Inception Distance (FID) in the table below. It can be seen that our model achieves superior generation performance compared to listed baseline models.</p>
    <div class="figure">
        <img src="./figure/image/svhn/synthesis/synthesis_latent_ebm.png" width="200" style="margin:10px">
        <img src="./figure/image/cifar10/synthesis/cifar10_syn.png" width="200" style="margin:10px">
        <img src="./figure/image/celeba/synthesis/celeba_latent_ebm_synthesis.png" width="200" style="margin:10px">
        <p class="caption"><b>Figure 1:</b> Generated samples for SVHN \((32 \times 32)\), CIFAR-10 \((32 \times 32)\), and CelebA \((64 \times 64)\).</p>
    </div>


    <div class="figure">
        <img src="./figure/image/fid/fid_table.png" width="800" style="margin:10px">
    </div>


    <h3>Experiment 2: Text</h3>
    <p> To evaluate the quality of the generated samples, we recruit Forward Perplexity (FPPL) and Reverse Perplexity (RPPL). FPPL is the perplexity of the generated samples evaluated under a language model trained with real data and measures the fluency of the synthesized sentences. RPPL is the perplexity of real data (the test data partition) computed under a language model trained with the model-generated samples. Prior work employs it to measure the distributional coverage of a learned model, \(p_\theta(x)\) in our case, since a model with a mode-collapsing issue results in a high RPPL. FPPL and RPPL are displayed in Table 2. Our model outperforms all the baselines on the two metrics, demonstrating the high fluency and diversity of the samples from our model. </p>
    <div class="figure">
        <img src="./figure/text/text_table.png" width="800" style="margin:10px">
    </div>


    <h3>Experiment 3: Analysis of latent space</h3>
    <p> We examine the exponential tilting of the reference prior \(p_0(z)\) through Langevin samples initialized from \(p_0(z)\) with target distribution \(p_\alpha(z)\). As the reference distribution \(p_0(z)\) is in the form of an isotropic Gaussian, we expect the energy-based correction \(f_\alpha\) to tilt \(p_0\) into an irregular shape like some shallow local modes. Therefore, the trajectory of a Markov chain initialized from the reference distribution \(p_0(z)\) with well-learned target \(p_\alpha(z)\) should depict the transition towards synthesized examples of high quality while the energy fluctuates around some constant. Figure 2 depicts such transitions for CelebA, which is based on a model trained with \(K_0 = 40\) steps. The quality of synthesis improves significantly with increasing number of steps.
 </p>
    <div class="figure">
        <img src="./figure/transition/image_transition.png" width="800" style="margin:10px">
        <p class="caption"><b>Figure 2:</b> Transition of Markov chains initialized from \(p_0(z)\) towards \(\tilde{p}_{\alpha}(z)\) for \(K_0'=100\) steps. Top: Trajectory in the CelebA data-space. Bottom: Energy profile over time.</p>
    </div>


    <h3>Experiment 4: Anomaly detection</h3>
    <p> If the generator and EBM are well learned, then the posterior \(p_\theta(z|x)\) would form a discriminative latent space that has separated probability densities for normal and anomalous data. Samples from such latent space can then be used as discriminative features to detect anomalies. We perform posterior sampling on the learned model to obtain the latent samples, and use the unnormalized log-posterior \(\log p_\theta(x, z)\) as our decision function. </p>
    <div class="figure">
        <img src="./figure/anomaly/anomaly_table.png" width="800" style="margin:10px">
    </div>


    <h3>Experiment 5: Scalability</h3>
    <p> We have also explored avenues to improve training speed and found that a PyTorch extension, NVIDIA Apex, is able to improve our model training 2.5 times. We test our method with Apex training on a larger scale dataset, CelebA \( (128 \times 128 \times 3) \). The learned model is able to synthesize examples with high fidelity. </p>
    <div class="figure">
        <img src="./figure/image/celeba_large/celeba128_synthesis.png" width="600" style="margin:10px">
    </div>


    <hr>
    <h2>Acknowledgements</h2>
    <p>The work is supported by NSF DMS-2015577, DARPA XAI N66001-17-2-4029, ARO W911NF1810296, ONR MURI N00014-16-1-2007, and XSEDE grant ASC170063. We thank NVIDIA for the donation of Titan V GPUs.</p>
</div>
</body>
</html>